var addCarModule=angular.module("addCarModule",["ui.router"]);addCarModule.config(["$stateProvider",function(a){a.state("addCar",{url:"/cars/addCar",templateUrl:"app/addCar/addCar.html",controller:"addCarCtrl"})}]);var carsModule=angular.module("carsModule",["ui.router"]);carsModule.config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("cars",{url:"/cars",templateUrl:"app/allCars/cars.html",controller:"carsCtrl",resolve:{carsPromise:["carsService",function(a){return a.getAll()}]}}),b.otherwise("cars")}]);var rentCarsApp=angular.module("rentCarsApp",["angularSpinner","carsModule","aboutCarModule","addCarModule","authModule","editCarModule","feedbacksModule","clientsModule","ui.bootstrap","ngAnimate"]),authModule=angular.module("authModule",["ui.router"]);authModule.config(["$stateProvider",function(a){a.state("login",{url:"/login",templateUrl:"app/authentification/login.html",controller:"authCtrl",onEnter:["$state","authService",function(a,b){b.isLoggedIn()&&a.go("cars")}]}).state("register",{url:"/register",templateUrl:"app/authentification/register.html",controller:"authCtrl",onEnter:["$state","authService",function(a,b){b.isLoggedIn()&&a.go("cars")}]})}]);var aboutCarModule=angular.module("aboutCarModule",["ui.router"]);aboutCarModule.config(["$stateProvider",function(a){a.state("aboutCar",{url:"/cars/aboutCar_{id}",templateUrl:"app/aboutCar(addOrder)/aboutCar.html",controller:"aboutCarCtrl",resolve:{carInfo:["$stateParams","carsService",function(a,b){return b.getCarInfo(a.id)}]}})}]);var editCarModule=angular.module("editCarModule",["ui.router"]);editCarModule.config(["$stateProvider",function(a){a.state("editCar",{url:"/cars/editCar_{id}",templateUrl:"app/editCar/editCar.html",controller:"editCarCtrl",resolve:{carInfo:["$stateParams","carsService",function(a,b){return b.getCarInfo(a.id)}]}})}]);var feedbacksModule=angular.module("feedbacksModule",["ui.router"]);feedbacksModule.config(["$stateProvider",function(a,b){a.state("feedbacks",{url:"/feedbacks",templateUrl:"app/feedbacks/feedbacks.html",controller:"feedbacksCtrl",resolve:{feedbacksPromise:["feedbacksService",function(a){return a.getFeedbacks()}]}})}]),angular.module("rentCarsApp").directive("ngDatePicker",[function(){return function(a){$(function(){var b=$("#addOrderDatePickerFrom"),c=$("#addOrderDatePickerTo"),d=$("#addOrderDatePickerBirth"),e=$("#inputAddOrderDatePickerFrom"),f=$("#inputAddOrderDatePickerTo"),g=$("#inputAddOrderDatePickerBirth");b.datetimepicker({format:"YYYY-MM-DD HH:mm",minDate:moment()}),c.datetimepicker({format:"YYYY-MM-DD HH:mm",minDate:moment().date(moment().date()+1)}),d.datetimepicker({viewMode:"years",format:"YYYY-MM-DD",maxDate:moment().subtract(18,"years"),minDate:"1900-01-01 00:00"}),b.on("dp.change",function(b){c.data("DateTimePicker").minDate(b.date),a.from=b.date.format("YYYY-MM-DD HH:mm")}),e.on("input",function(b){a.from=e.val()}),c.on("dp.change",function(c){b.data("DateTimePicker").maxDate(c.date),a.to=c.date.format("YYYY-MM-DD HH:mm")}),f.on("input",function(b){a.to=f.val()}),d.on("dp.change",function(b){a.dateBirth=b.date.format("YYYY-MM-DD")}),g.on("input",function(b){a.dateBirth=g.val()})})}}]),angular.module("aboutCarModule").filter("dateTimeFormat",[function(){return function(a){return moment(a).format("YYYY-MM-DD HH:mm")}}]),angular.module("authModule").controller("authCtrl",["$scope","$state","authService","usSpinnerService",function(a,b,c,d){a.user={},a.register=function(){c.register(a.user).error(function(b){d.stop("mainSpinner"),a.error=b}).then(function(){b.go("cars")})},a.logIn=function(){c.logIn(a.user).error(function(b){d.stop("mainSpinner"),a.error=b}).then(function(){b.go("cars")})}}]),angular.module("addCarModule").controller("addCarCtrl",["$scope","carsService","fileReader",function(a,b,c){a.max=100,a.progress=0,a.currentYear=(new Date).getFullYear(),a.getFile=function(){c.readAsDataUrl(a.file,a).then(function(b){a.imageSrc=b})},a.$on("fileProgress",function(b){a.progress=b.loaded/b.total}),a.addCar=function(){var c={model:angular.uppercase(a.model),year:a.year,doors:a.doors,airConditioner:a.airConditioner,autoTransmission:a.autoTransmission,vin:angular.uppercase(a.vin),price:a.price,image:a.imageSrc||"/img/noCar.png",orders:[]};b.create(c)}}]);var clients=angular.module("clientsModule",["ui.router"]);clients.config(["$stateProvider",function(a){a.state("clients",{url:"/clients",templateUrl:"app/clients/clients.html"})}]),angular.module("rentCarsApp").directive("ngAttempt",function(){return{restrict:"A",controller:["$scope",function(a){this.attempted=!1,this.setAttempted=function(){this.attempted=!0}}],link:function(a,b,c,d){var e=c.name;a.attempt=a.attempt||{},a.attempt[e]=d,b.bind("submit",function(b){d.setAttempted(),a.$$phase||a.$apply()})}}}),angular.module("rentCarsApp").directive("ngValidation",["$parse",function(a){return{restrict:"A",require:"form",link:function(b,c,d,e){var f=a(d.ngValidation);c.bind("submit",function(a){return e.$valid?void b.$apply(function(){f(b,{$event:a})}):!1})}}}]),angular.module("rentCarsApp").directive("ngModalPopUp",function(){return{restrict:"E",templateUrl:"/app/directives/modalPopUp/modalPopUp.html",transclude:!0,replace:!0,scope:!0,link:function(a,b,c){a.title=null,a.$watch(c.visible,function(d){d===!0?(a.title=c.title,$(b).modal("show")):$(b).modal("hide")}),$(b).on({"shown.bs.modal":function(){a.$$phase||a.$apply(function(){a.$parent[c.visible]=!0})},"hidden.bs.modal":function(){a.$$phase||a.$apply(function(){a.$parent[c.visible]=!1})}})}}}),angular.module("aboutCarModule").controller("aboutCarCtrl",["$scope","$location","$anchorScroll","carInfo","carsService","usSpinnerService",function(a,b,c,d,e,f){a.car=d,a.order={},a.sortType="from",a.sortReverse=!1,a.searchOrders="",a.showModal=!1,a.showAddOrderForm=!1,a.goToAddOrderForm=function(){a.showAddOrderForm=!0,b.hash("addOrderFocus"),c()},a.toggleModal=function(){a.showModal=!a.showModal},a.removeCar=function(c){e.removeCar(c).success(function(c){f.stop("mainSpinner"),a.showModal=!1,b.path("/cars")})},a.addOrder=function(){var b={from:new Date(a.order.from),to:new Date(a.order.to),startLocation:a.order.startLocation,finishLocation:a.order.finishLocation,addInfo:a.order.addInfo,firstName:angular.uppercase(a.order.firstName),lastName:angular.uppercase(a.order.lastName),dateBirth:new Date(a.order.dateBirth),docNumber:angular.uppercase(a.order.docNumber),phoneNumber:a.order.phoneNumber};e.addOrder(d._id,b).success(function(b){f.stop("mainSpinner"),a.car.orders.push(b)})}}]),angular.module("rentCarsApp").directive("ngEllipsis",["$document",function(a){return function(){a.ready(function(){$(".feedbackTextWrapper").dotdotdot({watch:!0})})}}]),angular.module("rentCarsApp").directive("ngFileSelect",[function(){return function(a,b){b.bind("change",function(b){a.file=b.target.files[0],a.getFile()})}}]),angular.module("rentCarsApp").directive("loader",[function(){return{restrict:"E",replace:!0,scope:{key:"@"},link:function(a,b,c){a.$on({"us-spinner:spin":function(c,d){d===a.key&&b.addClass("loading")},"us-spinner:stop":function(c,d){d===a.key&&b.removeClass("loading")}})},template:'<div class="us-spinner-wrapper"><div us-spinner spinner-key="{{key}}"></div></div>'}}]),angular.module("rentCarsApp").directive("ngPhoneHelper",[function(){return function(a){var b=$(".phoneNumber");b.intlTelInput(),b.on("input",function(b){"undefined"!=typeof a.order&&(a.order.phoneNumber=b.target.value),"undefined"!=typeof a.feedback&&(a.feedback.phoneNumber=b.target.value),a.$$phase||a.$apply()})}}]),angular.module("editCarModule").controller("editCarCtrl",["$scope","carsService","fileReader","carInfo",function(a,b,c,d){a.car=d,a.max=100,a.progress=100,a.currentYear=(new Date).getFullYear(),a.getFile=function(){c.readAsDataUrl(a.file,a).then(function(b){a.imageSrc=b,a.car.image=b})},a.$on("fileProgress",function(b){a.progress=b.loaded/b.total}),a.editCar=function(){b.editCar(a.car._id,a.car)}}]),angular.module("carsModule").controller("carsCtrl",["$scope","$location","carsService",function(a,b,c){a.cars=c.cars,a.toAboutCarPage=function(a){b.path("/cars/aboutCar_"+a)}}]),angular.module("feedbacksModule").filter("array",[function(){return function(a){return new Array(Math.ceil(a))}}]),angular.module("feedbacksModule").controller("feedbacksCtrl",["$scope","feedbacksService","usSpinnerService",function(a,b,c){a.feedback={},a.clickedFeedback={},a.allFeedbacks=b.feedbacks,a.showModalKeep=!1,a.showModalGet=!1,a.myInterval=!1,a.noWrapSlides=!1,a.itemsForSlide=3,a.toggleModalKeep=function(){a.showModalKeep=!a.showModalKeep},a.toggleModalGet=function(b){a.clickedFeedback=b,a.showModalGet=!a.showModalGet},a.addFeedback=function(){var d={name:a.feedback.name,phoneNumber:a.feedback.phoneNumber,text:a.feedback.text,approved:!1};b.createFeedback(d).success(function(d){c.stop("mainSpinner"),b.getFeedbacks(),a.toggleModalKeep()})}}]),angular.module("aboutCarModule").filter("dateBirthFormat",[function(){return function(a){return moment(a).format("YYYY-MM-DD")}}]),angular.module("feedbacksModule").factory("feedbacksService",["$http","usSpinnerService",function(a,b){var c={feedbacks:[]};return c.getFeedbacks=function(){return b.spin("mainSpinner"),a.get("/getFeedbacks").success(function(a){angular.copy(a,c.feedbacks),b.stop("mainSpinner")})},c.createFeedback=function(c){return b.spin("mainSpinner"),a.post("/postFeedback",c)},c}]),angular.module("rentCarsApp").controller("navigationCtrl",["$scope","$location","authService","doSearchService","$rootScope","usSpinnerService",function(a,b,c,d,e,f){e.globalSearch=!1,a.navigation={url:"app/navigationBar/navBar.html"},a.searchExpression={},a.isLoggedIn=c.isLoggedIn,a.currentUser=c.currentUser,a.logOut=c.logOut,a.data=null,a.sortType="from",a.sortReverse=!1,a.searchOrders="",a.doSearch=function(){return""===a.searchExpression.text?(a.data=null,void(e.globalSearch=!1)):void d(a.searchExpression.text).then(function(b){f.stop("mainSpinner"),a.data=b.data,e.globalSearch=!0},function(a){f.stop("mainSpinner"),console.error(a.data)})},a.isActive=function(a){var c=a===b.path();return c}}]),angular.module("rentCarsApp").factory("authService",["$http","$window","usSpinnerService",function(a,b,c){var d={};return d.saveToken=function(a){b.localStorage["rent-cars-token"]=a},d.getToken=function(){return b.localStorage["rent-cars-token"]},d.isLoggedIn=function(){var a=d.getToken();if(a){var c=JSON.parse(b.atob(a.split(".")[1]));return c.exp>Date.now()/1e3}return!1},d.currentUser=function(){if(d.isLoggedIn()){var a=d.getToken(),c=JSON.parse(b.atob(a.split(".")[1]));return c.username}},d.register=function(b){return c.spin("mainSpinner"),a.post("/register",b).success(function(a){c.stop("mainSpinner"),d.saveToken(a.token)})},d.logIn=function(b){return c.spin("mainSpinner"),a.post("/login",b).success(function(a){c.stop("mainSpinner"),d.saveToken(a.token)})},d.logOut=function(){b.localStorage.removeItem("rent-cars-token")},d}]),angular.module("rentCarsApp").factory("carsService",["$http","$location","usSpinnerService",function(a,b,c){var d={cars:[]};return d.getAll=function(){return c.spin("mainSpinner"),a.get("/getAllcars").success(function(a){c.stop("mainSpinner"),angular.copy(a,d.cars)})},d.create=function(d){return c.spin("mainSpinner"),a.post("/postCar",d).success(function(a){c.stop("mainSpinner"),b.path("/cars")})},d.editCar=function(d,e){return c.spin("mainSpinner"),a.put("/editCar_"+d,e).success(function(a){c.stop("mainSpinner"),b.path("/cars")})},d.getCarInfo=function(b){return c.spin("mainSpinner"),a.get("/allcars/getCar_"+b).then(function(a){return c.stop("mainSpinner"),a.data})},d.addOrder=function(b,d){return c.spin("mainSpinner"),a.post("/allcars/"+b+"/allorders",d)},d.removeCar=function(b){return c.spin("mainSpinner"),a["delete"]("/allcars/deleteCar_"+b)},d}]),angular.module("rentCarsApp").factory("doSearchService",["$http","usSpinnerService",function(a,b){var c=function(c){return b.spin("mainSpinner"),a.get("/getSearchResult",{params:{expression:c}})};return c}]),angular.module("rentCarsApp").factory("fileReader",["$q",function(a){var b=function(a,b,c){return function(){c.$apply(function(){b.resolve(a.result)})}},c=function(a,b,c){return function(){c.$apply(function(){b.reject(a.result)})}},d=function(a,b){return function(a){b.$broadcast("fileProgress",{total:a.total,loaded:a.loaded})}},e=function(a,e){var f=new FileReader;return f.onload=b(f,a,e),f.onerror=c(f,a,e),f.onprogress=d(f,e),f},f=function(b,c){var d=a.defer(),f=e(d,c);return f.readAsDataURL(b),d.promise};return{readAsDataUrl:f}}]);